<script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>
<script>
  async function loadProducts() {
    const container = document.getElementById('products-container');
    const converter = new showdown.Converter();

    try {
      const res = await fetch("/.netlify/functions/liste-produits");
      const files = await res.json();

      container.innerHTML = "";

      for (let file of files) {
        const res = await fetch(`./produits/${file}`);
        const text = await res.text();
        const html = converter.makeHtml(text);
        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = html;
        container.appendChild(div);
      }
    } catch (err) {
      container.innerHTML = "<p>Erreur de chargement des produits.</p>";
      console.error(err);
    }
  }

  loadProducts();
</script>
